from flask import Flask, render_template, request
from werkzeug.utils import secure_filename
from useful import predict, get_df
import os
app = Flask(__name__)

FILE_NAME = None


@app.route("/")
@app.route("/home")
@app.route("/index.html")
@app.route("/dashboard")
def home():
    return render_template("index.html")

@app.route("/history")
def history():
    return render_template("history.html")

@app.route("/settings")
def settings(): 
    return render_template("settings.html")

@app.route("/info")
def info():
    return render_template("info.html")

@app.route('/uploader', methods = ['GET', 'POST'])
def upload_file():
    global FILE_NAME
    if request.method == 'POST':
      f = request.files['file']
      f.save("utils/"+f.filename)
      FILE_NAME = "utils/"+f.filename
      return render_template("uploaded.html")

@app.route("/scan")
def scan():
    data = get_df(FILE_NAME)
    a = predict(data)
    if a[0] == 1:
        os.system(f'rm {FILE_NAME}')
        return "Malware"
    else:
        os.system(f'rm {FILE_NAME}')
        return "Safe"


if __name__ == "__main__":
    app.run(debug=True)
